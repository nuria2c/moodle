define(["jquery","core/notification","core/form-autocomplete","tool_lp/dialogue","core/str"],function(a,b,c,d,e){var f=function(){var d=this;a('input[name="allocationview"]').on("change",d.switchView.bind(d)),a(".allocation-see-results").on("click",d.renderAllocationResults.bind(d)),a(".manual-allocation-see-results").on("click",d.showAffectedParticipants.bind(d)),a(".random-allocation-button a").on("click",d.renderRandomAllocation.bind(d)),a("select[name=by], select[name=of]").on("change",function(b){b.preventDefault(),window.onbeforeunload=null,a(b.target).parents("form:first").submit()}),a(document).ready(function(){e.get_strings([{key:"addreviewer",component:"workshopallocation_manual"},{key:"addreviewee",component:"workshopallocation_manual"}]).done(function(b){a(".addreviewer").each(function(){c.enhance("#"+a(this).attr("id"),!1,!1,b[0])}),a(".addreviewee").each(function(){c.enhance("#"+a(this).attr("id"),!1,!1,b[1])})}).fail(b.exception)})};return f.prototype.showRandomAllocationForm=function(b){var c=a(b.getContent());c.find("fieldset.hidden").removeClass("hidden");var d=a('input[name="allocationview"]:checked').val();"reviewee"==d?c.find('select[name="numper"]').val(2):c.find('select[name="numper"]').val(1),c.find(".btn-cancel").on("click",function(a){a.preventDefault(),b.close()})},f.prototype.renderRandomAllocation=function(){var c=this;e.get_strings([{key:"pluginname",component:"workshopallocation_random"}]).done(function(b){var e=a(".allocator-random").html();new d(b[0],e,c.showRandomAllocationForm.bind(c),c.destroyDialogue)}).fail(b.exception)},f.prototype.renderAllocationResults=function(){var c=this;e.get_strings([{key:"allocationresults",component:"workshopallocation_random"}]).done(function(b){var e=a(".allocation-results-container").html();new d(b[0],e,function(){},c.destroyDialogue)}).fail(b.exception)},f.prototype.switchView=function(){var b=a('input[name="allocationview"]:checked').val();"reviewee"==b?(a(".allocations .reviewerof").hide(),a(".allocations .reviewedby").show(),M.util.set_user_preference("workshopallocation_manual_view","reviewedby")):(a(".allocations .reviewedby").hide(),a(".allocations .reviewerof").show(),M.util.set_user_preference("workshopallocation_manual_view","reviewerof"))},f.prototype.showAffectedParticipants=function(){var c=this;0!=a(".allocation-popup-content").length&&e.get_strings([{key:"affectedparticipants",component:"workshopallocation_manual"}]).done(function(b){var e=a(".allocation-popup-content").html();new d(b[0],e,function(){},c.destroyDialogue,(!0))}).fail(b.exception)},f.prototype.destroyDialogue=function(a){a.close()},{init:function(){new f}}});